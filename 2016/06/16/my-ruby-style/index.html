<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="语法,Ruby,风格," />





  <link rel="alternate" href="/atom.xml" title="小土刀" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="好的风格是成功的一半。">
<meta property="og:type" content="article">
<meta property="og:title" content="Ruby 编码风格指南">
<meta property="og:url" content="http://wdxtub.com/2016/06/16/my-ruby-style/index.html">
<meta property="og:site_name" content="小土刀">
<meta property="og:description" content="好的风格是成功的一半。">
<meta property="og:updated_time" content="2017-03-11T01:54:01.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ruby 编码风格指南">
<meta name="twitter:description" content="好的风格是成功的一半。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '小土刀'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://wdxtub.com/2016/06/16/my-ruby-style/"/>





  <title> Ruby 编码风格指南 | 小土刀 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=59042340";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">小土刀</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Agony is my triumph</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-work">
          <a href="/2016/09/11/work-page" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-wifi"></i> <br />
            
            不周山
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tech">
          <a href="/2009/09/11/tech-page" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-gear"></i> <br />
            
            通天塔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-life">
          <a href="/1990/09/11/life-page" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-compass"></i> <br />
            
            好望角
          </a>
        </li>
      
        
        <li class="menu-item menu-item-booklist">
          <a href="/1997/09/11/booklist-page" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-diamond"></i> <br />
            
            书影音
          </a>
        </li>
      
        
        <li class="menu-item menu-item-thanks">
          <a href="/thanks" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://wdxtub.com/2016/06/16/my-ruby-style/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="wdxtub">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/misc/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="小土刀">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="小土刀" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Ruby 编码风格指南
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-06-16T20:12:32+08:00">
                2016-06-16
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              <span class="post-meta-item-text">更新于</span>
              <time title="更新于" itemprop="dateModified" datetime="2017-03-11T09:54:01+08:00">
                2017-03-11
              </time>
            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Technique/" itemprop="url" rel="index">
                    <span itemprop="name">Technique</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>好的风格是成功的一半。</p>
<a id="more"></a>
<hr>
<p>更新记录</p>
<ul>
<li>2016.06.26: 初稿</li>
</ul>
<p>网上已经有一份非常详尽的 <a href="https://github.com/JuanitoFatas/ruby-style-guide/blob/master/README-zhCN.md" target="_blank" rel="external">Ruby 风格指南</a>，但是光看是没办法快速入门的，而且前面提到的指南太详尽，有的时候反而不太实用，所以我决定一边学习一边把自己的理解记录下来（几乎全部内容都来自前面的链接，我只是根据自己习惯重新编排了一下），一份良好的风格指南是极佳的学习资料。</p>
<h2 id="源代码排版"><a href="#源代码排版" class="headerlink" title="源代码排版"></a>源代码排版</h2><ul>
<li>使用 <code>UTF-8</code> 编码</li>
<li>用两个空格缩进</li>
<li>不使用分号，一行一条语句</li>
<li>定义方法时，避免单行写法<ul>
<li>这个规则的一个例外是空方法: <code>def no_op; end</code></li>
</ul>
</li>
<li>大括号前后添加空格，小括号和中括号不<ul>
<li>在插值表达式中的大括号两端不要添加空格</li>
</ul>
</li>
<li>把 <code>when</code> 与 <code>case</code> 缩排在同一层级</li>
<li>在各个方法定义之间添加空行，并且将方法分成若干合乎逻辑的段落</li>
<li>避免在方法调用的最后一个参数之后添加逗号，尤其当参数没有分布在同一行时</li>
<li>当方法调用参数过长时，将它们排列在多行并对齐。若对齐后长度超过行宽限制，将首个参数位置挪到下一行进行缩排也是可以接受的</li>
<li>当构建数组时，若元素跨行，应当保持对齐</li>
<li>使用 <code>_</code> 语法改善大数的数值字面量的可读性，如 <code>num = 1_000_000</code></li>
<li>不要在注释与 <code>def</code> 之间添加空行</li>
<li>将单行长度控制在 80 个字符内，避免行尾空格，文件以空白行结束</li>
<li>不要使用区块注释</li>
<li>永远不要在方法名与左括号之间添加空格</li>
<li>运行 Ruby 解释器时，总是开启 <code>-w</code> 选项来。如果你忘了某个上述某个规则，它就会警告你</li>
</ul>
<p>对于没有主体的类，倾向使用单行定义</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooError</span> &lt; StandardError</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 勉强可以</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooError</span> &lt; StandardError;</span> <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">FooError = Class.new(StandardError)</div></pre></td></tr></table></figure>
<p>当将一个条件表达式的结果赋值给一个变量时，保持分支缩排在同一层级</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 好 - 并且更好地利用行宽</span></div><div class="line">kind =</div><div class="line">  <span class="keyword">case</span> year</div><div class="line">  <span class="keyword">when</span> <span class="number">1850</span>..<span class="number">1889</span> <span class="keyword">then</span> <span class="string">'Blues'</span></div><div class="line">  <span class="keyword">when</span> <span class="number">1890</span>..<span class="number">1909</span> <span class="keyword">then</span> <span class="string">'Ragtime'</span></div><div class="line">  <span class="keyword">when</span> <span class="number">1910</span>..<span class="number">1929</span> <span class="keyword">then</span> <span class="string">'New Orleans Jazz'</span></div><div class="line">  <span class="keyword">when</span> <span class="number">1930</span>..<span class="number">1939</span> <span class="keyword">then</span> <span class="string">'Swing'</span></div><div class="line">  <span class="keyword">when</span> <span class="number">1940</span>..<span class="number">1950</span> <span class="keyword">then</span> <span class="string">'Bebop'</span></div><div class="line">  <span class="keyword">else</span> <span class="string">'Jazz'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">result =</div><div class="line">  <span class="keyword">if</span> some_cond</div><div class="line">    calc_something</div><div class="line">  <span class="keyword">else</span></div><div class="line">    calc_something_else</div><div class="line">  <span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>当给方法的参数赋予默认值时，在 = 前后添加空格</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">(arg1 = <span class="symbol">:default</span>, arg2 = <span class="literal">nil</span>, arg3 = [])</span></span></div><div class="line">  <span class="comment"># 做一些事情</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><ul>
<li>永远不要在多行 <code>if/unless</code> 中使用 <code>then</code></li>
<li>在多行 <code>if/unless</code> 中，总是把条件表达式与 <code>if/unless</code> 放置在同一行</li>
<li>单行情况下，倾向使用三元操作符（<code>?:</code>）而不是 <code>if/then/else/end</code> 结构。前者更为常见且简练</li>
<li>避免使用多行三元操作符（<code>?:</code>）。使用 <code>if/unless</code> 来替代</li>
<li>三元操作符的每个分支只写一个表达式。即不要嵌套三元操作符。嵌套情况请使用 <code>if/else</code> 结构</li>
<li>在 <code>case</code> 表达式中，单行情况使用 <code>when x then ...</code> 语法</li>
<li>使用 <code>!</code> 而不是 <code>not</code></li>
<li>永远不要使用 <code>and</code> 与 <code>or</code> 关键字。使用 <code>&amp;&amp;</code> 与 <code>||</code> 来替代</li>
<li>不要使用括号包裹 <code>if/unless/while/until</code> 的条件表达式</li>
<li>对于无限循环，使用 <code>Kernel#loop</code> 而不是 <code>while/until</code></li>
<li>避免在不需要流程控制的情况下使用 <code>return</code></li>
<li>避免在不需要的情况下使用 <code>self</code>。（只有在调用 <code>self</code> 的修改器时才需要）</li>
<li>避免局部变量遮蔽方法调用，除非它们具有相同效果</li>
<li>当变量尚未初始化时，使用 <code>||=</code> 对其进行初始化</li>
<li>不要使用 <code>||=</code> 对布尔变量进行初始化</li>
<li>避免使用 <code>case</code> 语句等价操作符 <code>===</code>。从名称可知，这是 <code>case</code> 语句隐式使用的操作符，在 <code>case</code> 语句外的场合中使用，会产生难以理解的代码</li>
<li>能使用 <code>==</code> 就不要使用 <code>eql?</code>。提供更加严格比较的 <code>eql?</code> 在实践中极少使用</li>
<li>未被使用的区块参数或局部变量，添加 <code>_</code> 前缀或直接使用 <code>_</code>（尽管表意性略差）。这种做法可以抑制 Ruby 解释器或 RuboCop 等工具发出“变量尚未使用”的警告</li>
<li>使用 <code>$stdout/$stderr/$stdin</code> 而不是 <code>STDOUT/STDERR/STDIN</code>。<code>STDOUT/STDERR/STDIN</code> 是常量，尽管在 Ruby 中允许给常量重新赋值（可能是重定向某些流），但解释器会发出警告</li>
<li>使用 <code>warn</code> 而不是 <code>$stderr.puts</code>。除了更加简练清晰外，<code>warn</code> 允许你在需要时通过设置解释器选项（使用 <code>-W0</code> 将警告级别设置为 0）来抑制警告</li>
<li>倾向使用 <code>map</code> 而不是 <code>collect</code>，<code>find</code> 而不是 <code>detect</code>，<code>select</code> 而不是 <code>find_all</code>，<code>reduce</code> 而不是 <code>inject</code> 以及 <code>size</code> 而不是 <code>length</code>。这不是一个硬性要求，如果使用别名可以增强可读性，使用它也没关系。这些别名方法继承自 Smalltalk 语言，但在别的语言并不通用。鼓励使用 <code>select</code> 而不是 <code>find_all</code> 的理由是前者与 <code>reject</code> 搭配起来一目了然</li>
<li>不要使用 <code>count</code> 作为 <code>size</code> 的替代方案。除了 Array 外，其他 Enumerable 对象都需要通过枚举整个集合才可以确定数目</li>
<li>倾向使用 <code>reverse_each</code> 而不是 <code>reverse.each</code>，因为某些混入 Enumerable 模块的类可能会提供 <code>reverse_each</code> 的高效版本。即使这些类没有提供专门特化的版本，继承自 Enumerable 的通用版本至少能保证性能与 <code>reverse.each</code> 相当</li>
</ul>
<p>使用 <code>::</code> 引用常量（包括类与模块）与构造器（比如 <code>Array()</code>、<code>Nokogiri::HTML()</code>）。不要使用 <code>::</code> 调用常规方法</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">SomeClass::some_method</div><div class="line">some_object::some_method</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">SomeClass.some_method</div><div class="line">some_object.some_method</div><div class="line">SomeModule::SomeClass::SOME_CONST</div><div class="line">SomeModule::SomeClass()</div></pre></td></tr></table></figure>
<p>使用 <code>def</code> 定义方法时，如果有参数则使用括号，如果无参数则省略括号</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></div><div class="line"> <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method_with_parameters</span><span class="params">(param1, param2)</span></span></div><div class="line"> <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>定义可选参数时，将可选参数放置在参数列表尾部。如果可选参数出现在列表头部，则此方法在调用时可能会产生预期之外的结果</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">(a = <span class="number">1</span>, b = <span class="number">2</span>, c, d)</span></span></div><div class="line">  puts <span class="string">"<span class="subst">#&#123;a&#125;</span>, <span class="subst">#&#123;b&#125;</span>, <span class="subst">#&#123;c&#125;</span>, <span class="subst">#&#123;d&#125;</span>"</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>) <span class="comment"># =&gt; '1, 2, w, x'</span></div><div class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>) <span class="comment"># =&gt; 'w, 2, x, y'</span></div><div class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>) <span class="comment"># =&gt; 'w, x, y, z'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_method</span><span class="params">(c, d, a = <span class="number">1</span>, b = <span class="number">2</span>)</span></span></div><div class="line">  puts <span class="string">"<span class="subst">#&#123;a&#125;</span>, <span class="subst">#&#123;b&#125;</span>, <span class="subst">#&#123;c&#125;</span>, <span class="subst">#&#123;d&#125;</span>"</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>) <span class="comment"># =&gt; '1, 2, w, x'</span></div><div class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>) <span class="comment"># =&gt; 'y, 2, w, x'</span></div><div class="line">some_method(<span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>) <span class="comment"># =&gt; 'y, z, w, x'</span></div></pre></td></tr></table></figure>
<p>定义变量时，避免并行赋值。但当右值为方法调用返回值，或是与 * 操作符配合使用，或是交换两个变量的值，并行赋值也是可以接受的。并行赋值的可读性通常不如分开赋值</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">a, b, c, d = <span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>, <span class="string">'foobar'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">a = <span class="string">'foo'</span></div><div class="line">b = <span class="string">'bar'</span></div><div class="line">c = <span class="string">'baz'</span></div><div class="line">d = <span class="string">'foobar'</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 交换两个变量的值</span></div><div class="line">a = <span class="string">'foo'</span></div><div class="line">b = <span class="string">'bar'</span></div><div class="line"></div><div class="line">a, b = b, a</div><div class="line">puts a <span class="comment"># =&gt; 'bar'</span></div><div class="line">puts b <span class="comment"># =&gt; 'foo'</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 右值为方法调用返回值</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">multi_return</span></span></div><div class="line">  [<span class="number">1</span>, <span class="number">2</span>]</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">first, second = multi_return</div><div class="line"></div><div class="line"><span class="comment"># 好 - 与 * 操作符配合使用</span></div><div class="line">first, *list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>] <span class="comment"># first =&gt; 1, list =&gt; [2, 3, 4]</span></div><div class="line"></div><div class="line">hello_array = *<span class="string">'Hello'</span> <span class="comment"># =&gt; ["Hello"]</span></div><div class="line"></div><div class="line">a = *(<span class="number">1</span>..<span class="number">3</span>) <span class="comment"># =&gt; [1, 2, 3]</span></div></pre></td></tr></table></figure>
<p>除非必要，否则避免在并行赋值时使用单字符的 <code>_</code> 变量。优先考虑前缀形式的下划线变量，而不是直接使用 <code>_</code>，因为前者可以提供一定的语义信息。但当赋值语句左侧出现带 <code>*</code> 操作符的变量时，使用 <code>_</code> 也是可以接受的</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line">foo = <span class="string">'one,two,three,four,five'</span></div><div class="line"></div><div class="line"><span class="comment"># 差 - 可有可无，且无任何有用信息</span></div><div class="line">first, second, <span class="number">_</span> = foo.split(<span class="string">','</span>)</div><div class="line">first, <span class="number">_</span>, <span class="number">_</span> = foo.split(<span class="string">','</span>)</div><div class="line">first, *<span class="number">_</span> = foo.split(<span class="string">','</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">a, = foo.split(<span class="string">','</span>)</div><div class="line">a, b, = foo.split(<span class="string">','</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好 - 可有可无，但提供了额外信息</span></div><div class="line">first, _second = foo.split(<span class="string">','</span>)</div><div class="line">first, _second, = foo.split(<span class="string">','</span>)</div><div class="line">first, *_ending = foo.split(<span class="string">','</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好 - 占位符，_ 担当最后一个元素</span></div><div class="line">*beginning, <span class="number">_</span> = foo.split(<span class="string">','</span>)</div><div class="line">*beginning, something, <span class="number">_</span> = foo.split(<span class="string">','</span>)</div></pre></td></tr></table></figure>
<p>永远不要使用 <code>for</code>， 除非你很清楚为什么。大部分情况下，你应该使用迭代器。<code>for</code> 是由 <code>each</code> 实现的，所以你绕弯了。另外，<code>for</code> 没有引入一个新的作用域 (<code>each</code> 有），因此在它内部定义的变量在外部仍是可见的。</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line">arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">for</span> elem <span class="keyword">in</span> arr <span class="keyword">do</span></div><div class="line">  puts elem</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 注意，elem 可在 for 循环外部被访问</span></div><div class="line">elem <span class="comment"># =&gt; 3</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">arr.each &#123; <span class="params">|elem|</span> puts elem &#125;</div><div class="line"></div><div class="line"><span class="comment"># 注意，elem 不可在 each 块外部被访问</span></div><div class="line">elem <span class="comment"># =&gt; NameError: undefined local variable or method `elem'</span></div></pre></td></tr></table></figure>
<p>利用『<code>if</code> 与 <code>case</code> 是表达式』的这个特性</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">if</span> condition</div><div class="line">  result = x</div><div class="line"><span class="keyword">else</span></div><div class="line">  result = y</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">result =</div><div class="line">  <span class="keyword">if</span> condition</div><div class="line">    x</div><div class="line">  <span class="keyword">else</span></div><div class="line">    y</div><div class="line">  <span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>避免在多行区块后使用 <code>if/unless</code> 修饰语法</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="number">10</span>.times <span class="keyword">do</span></div><div class="line">  <span class="comment"># 省略多行主体</span></div><div class="line"><span class="keyword">end</span> <span class="keyword">if</span> some_condition</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">if</span> some_condition</div><div class="line">  <span class="number">10</span>.times <span class="keyword">do</span></div><div class="line">    <span class="comment"># 省略多行主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>在多行 <code>while/until</code> 中，不要使用 <code>while/until condition do</code></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">while</span> x &gt; <span class="number">5</span> <span class="keyword">do</span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">until</span> x &gt; <span class="number">5</span> <span class="keyword">do</span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">while</span> x &gt; <span class="number">5</span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">until</span> x &gt; <span class="number">5</span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>对于后置条件循环语句，倾向使用 <code>Kernel#loop</code> 与 <code>break</code> 的组合，而不是 <code>begin/end/until</code> 或 <code>begin/end/while</code></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  puts val</div><div class="line">  val += <span class="number">1</span></div><div class="line"><span class="keyword">end</span> <span class="keyword">while</span> val &lt; <span class="number">0</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">loop <span class="keyword">do</span></div><div class="line">  puts val</div><div class="line">  val += <span class="number">1</span></div><div class="line">  <span class="keyword">break</span> unless val &lt; <span class="number">0</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>对于可选参数的哈希，省略其外围的花括号</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">user.set(&#123; <span class="symbol">name:</span> <span class="string">'John'</span>, <span class="symbol">age:</span> <span class="number">45</span>, <span class="symbol">permissions:</span> &#123; <span class="symbol">read:</span> <span class="literal">true</span> &#125; &#125;)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">user.set(<span class="symbol">name:</span> <span class="string">'John'</span>, <span class="symbol">age:</span> <span class="number">45</span>, <span class="symbol">permissions:</span> &#123; <span class="symbol">read:</span> <span class="literal">true</span> &#125;)</div></pre></td></tr></table></figure>
<p>对于 DSL 的内部方法调用，同时省略其外围的圆括号与花括号</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> &lt; ActiveRecord::Base</span></div><div class="line">  <span class="comment"># 差</span></div><div class="line">  validates(<span class="symbol">:name</span>, &#123; <span class="symbol">presence:</span> <span class="literal">true</span>, <span class="symbol">length:</span> &#123; <span class="symbol">within:</span> <span class="number">1</span>..<span class="number">10</span> &#125; &#125;)</div><div class="line"></div><div class="line">  <span class="comment"># 好</span></div><div class="line">  validates <span class="symbol">:name</span>, <span class="symbol">presence:</span> <span class="literal">true</span>, <span class="symbol">length:</span> &#123; <span class="symbol">within:</span> <span class="number">1</span>..<span class="number">10</span> &#125;</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>当被调用方法是当前区块中唯一操作时，倾向使用简短的传参语法</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">names.map &#123; <span class="params">|name|</span> name.upcase &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">names.map(&amp;<span class="symbol">:upcase</span>)</div></pre></td></tr></table></figure>
<p>不要在条件表达式中使用 <code>=</code>（赋值语句）的返回值，除非赋值语句包裹在括号之中。这种惯用法被称作条件表达式中的安全赋值</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差 - 会出现警告</span></div><div class="line"><span class="keyword">if</span> v = array.grep(<span class="regexp">/foo/</span>)</div><div class="line">  do_something(v)</div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 尽管 Ruby 解释器仍会出现警告，但 RuboCop 不会</span></div><div class="line"><span class="keyword">if</span> (v = array.grep(<span class="regexp">/foo/</span>))</div><div class="line">  do_something(v)</div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">v = array.grep(<span class="regexp">/foo/</span>)</div><div class="line"><span class="keyword">if</span> v</div><div class="line">  do_something(v)</div><div class="line">  ...</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>使用 <code>&amp;&amp;=</code> 预先检查变量是否存在，如果存在，则做相应动作。使用 &amp;&amp;= 语法可以省去 <code>if</code> 检查</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">if</span> something</div><div class="line">  something = something.downcase</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">something = something ? something.downcase : <span class="literal">nil</span></div><div class="line"></div><div class="line"><span class="comment"># 勉强可以</span></div><div class="line">something = something.downcase <span class="keyword">if</span> something</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">something = something &amp;&amp; something.downcase</div><div class="line"></div><div class="line"><span class="comment"># 更好</span></div><div class="line">something &amp;&amp;= something.downcase</div></pre></td></tr></table></figure>
<p>避免使用 Perl 风格的特殊变量（比如 <code>$:</code>、<code>$;</code> 等）。它们看起来非常神秘，但除了单行脚本，其他情况并不鼓励使用。建议使用 <code>English</code> 程序库提供的友好别名</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">$:.unshift File.dirname(__FILE_<span class="number">_</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">require</span> <span class="string">'English'</span></div><div class="line">$LOAD_PATH.unshift File.dirname(__FILE_<span class="number">_</span>)</div></pre></td></tr></table></figure>
<p>不要在方法中嵌套定义方法，使用 lambda 方法来替代。 嵌套定义产生的方法，事实上和外围方法处于同一作用域（比如类作用域）。此外，“嵌套方法”会在定义它的外围方法每次调用时被重新定义</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(y)</span></span></div><div class="line">    <span class="comment"># 省略主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  bar(x)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 作用同前，但 bar 不会在 foo 每次调用时被重新定义</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(y)</span></span></div><div class="line">  <span class="comment"># 省略主体</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span></span></div><div class="line">  bar(x)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span></span></div><div class="line">  bar = -&gt;(y) &#123; ... &#125;</div><div class="line">  bar.call(x)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>对于单行区块，使用新的 <code>lambda</code> 字面量定义语法。对于多行区块，使用 <code>lambda</code> 定义语法</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">l = lambda &#123; <span class="params">|a, b|</span> a + b &#125;</div><div class="line">l.call(<span class="number">1</span>, <span class="number">2</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好 - 但看起来怪怪的</span></div><div class="line">l = -&gt;(a, b) <span class="keyword">do</span></div><div class="line">  tmp = a * <span class="number">7</span></div><div class="line">  tmp * b / <span class="number">50</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">l = -&gt;(a, b) &#123; a + b &#125;</div><div class="line">l.call(<span class="number">1</span>, <span class="number">2</span>)</div><div class="line"></div><div class="line">l = lambda <span class="keyword">do</span> <span class="params">|a, b|</span></div><div class="line">  tmp = a * <span class="number">7</span></div><div class="line">  tmp * b / <span class="number">50</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>定义 lambda 方法时，如果有参数则使用括号</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">l = -&gt;x, y &#123; something(x, y) &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">l = -&gt;(x, y) &#123; something(x, y) &#125;</div></pre></td></tr></table></figure>
<p>定义 lambda 方法时，如果无参数则省略括号</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">l = -&gt;() &#123; something &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">l = -&gt; &#123; something &#125;</div></pre></td></tr></table></figure>
<p>倾向使用 <code>proc</code> 而不是 <code>Proc.new</code></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">p = Proc.new &#123; <span class="params">|n|</span> puts n &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">p = proc &#123; <span class="params">|n|</span> puts n &#125;</div></pre></td></tr></table></figure>
<p>对于 lambda 方法或代码块，倾向使用 <code>proc.call()</code> 而不是 <code>proc[]</code> 或 <code>proc.()</code></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差 - 看上去像是枚举器的存取操作</span></div><div class="line">l = -&gt;(v) &#123; puts v &#125;</div><div class="line">l[<span class="number">1</span>]</div><div class="line"></div><div class="line"><span class="comment"># 差 - 极少见的调用语法</span></div><div class="line">l = -&gt;(v) &#123; puts v &#125;</div><div class="line">l.(<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">l = -&gt;(v) &#123; puts v &#125;</div><div class="line">l.call(<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>倾向使用 <code>sprintf</code> 或其别名 <code>format</code> 而不是相当晦涩的 <code>String#%</code> 方法</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="string">'%d %d'</span> % [<span class="number">20</span>, <span class="number">10</span>]</div><div class="line"><span class="comment"># =&gt; '20 10'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">sprintf(<span class="string">'%d %d'</span>, <span class="number">20</span>, <span class="number">10</span>)</div><div class="line"><span class="comment"># =&gt; '20 10'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">sprintf(<span class="string">'%&#123;first&#125; %&#123;second&#125;'</span>, <span class="symbol">first:</span> <span class="number">20</span>, <span class="symbol">second:</span> <span class="number">10</span>)</div><div class="line"><span class="comment"># =&gt; '20 10'</span></div><div class="line"></div><div class="line">format(<span class="string">'%d %d'</span>, <span class="number">20</span>, <span class="number">10</span>)</div><div class="line"><span class="comment"># =&gt; '20 10'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">format(<span class="string">'%&#123;first&#125; %&#123;second&#125;'</span>, <span class="symbol">first:</span> <span class="number">20</span>, <span class="symbol">second:</span> <span class="number">10</span>)</div><div class="line"><span class="comment"># =&gt; '20 10'</span></div></pre></td></tr></table></figure>
<p>倾向使用 <code>Array#join</code> 而不是相当晦涩的带字符参数的 <code>Array#*</code> 方法</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="string">%w(one two three)</span> * <span class="string">', '</span></div><div class="line"><span class="comment"># =&gt; 'one, two, three'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="string">%w(one two three)</span>.join(<span class="string">', '</span>)</div><div class="line"><span class="comment"># =&gt; 'one, two, three'</span></div></pre></td></tr></table></figure>
<p>当你希望处理的变量类型是数组，但不太确定其是否真的是数组时，通过使用 <code>Array()</code> 来替代显式的数组类型检查与转换</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">paths = [paths] unless paths.is_a? Array</div><div class="line">paths.each &#123; <span class="params">|path|</span> do_something(path) &#125;</div><div class="line"></div><div class="line"><span class="comment"># 差 - 总是构建新的数组对象</span></div><div class="line">[*paths].each &#123; <span class="params">|path|</span> do_something(path) &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">Array(paths).each &#123; <span class="params">|path|</span> do_something(path) &#125;</div></pre></td></tr></table></figure>
<p>通过使用范围或 <code>Comparable#between?</code> 来替代复杂的比较逻辑</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">do_something <span class="keyword">if</span> x &gt;= <span class="number">1000</span> &amp;&amp; x &lt;= <span class="number">2000</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">do_something <span class="keyword">if</span> (<span class="number">1000</span>..<span class="number">2000</span>).<span class="keyword">include</span>?(x)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">do_something <span class="keyword">if</span> x.between?(<span class="number">1000</span>, <span class="number">2000</span>)</div></pre></td></tr></table></figure>
<p>倾向使用谓词方法而不是 <code>==</code> 操作符。但数值比较除外</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">1</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> x == <span class="literal">nil</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">if</span> x.even?</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> x.odd?</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> x.<span class="literal">nil</span>?</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> x.zero?</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> x == <span class="number">0</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>不做显式的 non-nil 检查，除非检查对象是布尔变量</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">do_something <span class="keyword">if</span> !something.<span class="literal">nil</span>?</div><div class="line">do_something <span class="keyword">if</span> something != <span class="literal">nil</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">do_something <span class="keyword">if</span> something</div><div class="line"></div><div class="line"><span class="comment"># 好 - 检查对象是布尔变量</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">value_set?</span></span></div><div class="line">  !@some_boolean.<span class="literal">nil</span>?</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>避免使用 BEGIN 区块。永远不要使用 END 区块。使用 Kernel#at_exit 来替代</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">END</span> &#123; puts <span class="string">'Goodbye!'</span> &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">at_exit &#123; puts <span class="string">'Goodbye!'</span> &#125;</div></pre></td></tr></table></figure>
<p>倾向使用防御从句进行非法数据断言。防御从句是指处于方法顶部的条件语句，其能尽早地退出方法</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_thing</span><span class="params">(thing)</span></span></div><div class="line">  <span class="keyword">if</span> thing[<span class="symbol">:foo</span>]</div><div class="line">    update_with_bar(thing)</div><div class="line">    <span class="keyword">if</span> thing[<span class="symbol">:foo</span>][<span class="symbol">:bar</span>]</div><div class="line">      partial_compute(thing)</div><div class="line">    <span class="keyword">else</span></div><div class="line">      re_compute(thing)</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_thing</span><span class="params">(thing)</span></span></div><div class="line">  <span class="keyword">return</span> unless thing[<span class="symbol">:foo</span>]</div><div class="line">  update_with_bar(thing[<span class="symbol">:foo</span>])</div><div class="line">  <span class="keyword">return</span> re_compute(thing) unless thing[<span class="symbol">:foo</span>][<span class="symbol">:bar</span>]</div><div class="line">  partial_compute(thing)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>循环中，倾向使用 next 而不是条件区块</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].each <span class="keyword">do</span> <span class="params">|item|</span></div><div class="line">  <span class="keyword">if</span> item &gt; <span class="number">1</span></div><div class="line">    puts item</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].each <span class="keyword">do</span> <span class="params">|item|</span></div><div class="line">  <span class="keyword">next</span> unless item &gt; <span class="number">1</span></div><div class="line">  puts item</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h2 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h2><ul>
<li>标识符使用英文命名</li>
<li>符号、方法、变量使用蛇底式小写（<code>snake_case</code>）</li>
<li>类与模块使用驼峰式大小写（<code>CamelCase</code>）。（HTTP、RFC、XML 等首字母缩写应该仍旧保持大写形式）</li>
<li>文件名使用蛇底式小写，如 <code>hello_world.rb</code></li>
<li>目录名使用蛇底式小写，如 <code>lib/hello_world/hello_world.rb</code></li>
<li>尽量使一个源文件中只有一个类或模块。文件名就是类名或模块名，但使用蛇底式小写而不是驼峰式大小写</li>
<li>其他常量使用尖叫蛇底式大写（<code>SCREAMING_SNAKE_CASE</code>）</li>
<li>谓词方法（返回布尔值的方法）的名字应当以问号结尾。（比如 <code>Array#empty?</code>）。不返回布尔值的方法不应以问号结尾</li>
<li>谓词方法的名字应当避免使用 <code>is</code>、<code>does</code>、<code>can</code> 等助动词作为前缀。这些助动词在实际场景中显得冗余，且与标准库的命名习惯（比如 <code>empty?</code>、<code>include?</code>）很不一致</li>
<li>具有潜在危险性的方法，当其存在对应安全版本的方法时，其名字应当以惊叹号结尾。（比如修改 <code>self</code> 或参数值的方法、相对 <code>exit</code> 方法不会在退出时运行 <code>finalizers</code> 执行清理工作的 <code>exit!</code> 方法等）</li>
<li>尽量根据危险方法来定义对应安全版本的方法</li>
<li>当配合单行区块使用 <code>reduce</code> 时，将参数命名为 <code>|a, e|</code>（accumulator/累加器，element/元素）</li>
<li>当定义二元操作符时，将参数命名为 <code>other</code>（<code>&lt;&lt;</code> 与 <code>[]</code> 例外，因为其语义与此不同）</li>
</ul>
<h2 id="类与模块"><a href="#类与模块" class="headerlink" title="类与模块"></a>类与模块</h2><p>在类定义中，使用一致的结构</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="comment"># 首先是 extend 与 include</span></div><div class="line">  extend SomeModule</div><div class="line">  <span class="keyword">include</span> AnotherModule</div><div class="line"></div><div class="line">  <span class="comment"># 内部类</span></div><div class="line">  CustomErrorKlass = Class.new(StandardError)</div><div class="line"></div><div class="line">  <span class="comment"># 接着是常量</span></div><div class="line">  SOME_CONSTANT = <span class="number">20</span></div><div class="line"></div><div class="line">  <span class="comment"># 接下来是属性宏</span></div><div class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:name</span></div><div class="line"></div><div class="line">  <span class="comment"># 跟着是其他宏（如果有的话）</span></div><div class="line">  validates <span class="symbol">:name</span></div><div class="line"></div><div class="line">  <span class="comment"># 公开的类方法接在下一行</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">some_method</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 初始化方法在类方法和实例方法之间</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 跟着是公开的实例方法</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 受保护及私有的方法等放在接近结尾的地方</span></div><div class="line">  protected</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_protected_method</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  private</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_private_method</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>如果嵌套类数目较多，进而导致外围类定义较长，则将它们从外围类中提取出来，分别放置在单独的以嵌套类命名的文件中，并将文件归类至以外围类命名的文件夹下</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"></div><div class="line"><span class="comment"># foo.rb</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></div><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Bar</span></span></div><div class="line">    <span class="comment"># 定义 30 多个方法</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Car</span></span></div><div class="line">    <span class="comment"># 定义 20 多个方法</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 定义 30 多个方法</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"></div><div class="line"><span class="comment"># foo.rb</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></div><div class="line">  <span class="comment"># 定义 30 多个方法</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># foo/bar.rb</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></div><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Bar</span></span></div><div class="line">    <span class="comment"># 定义 30 多个方法</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># foo/car.rb</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></div><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Car</span></span></div><div class="line">    <span class="comment"># 定义 20 多个方法</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>定义只有类方法的数据类型时，倾向使用模块而不是类。只有当需要实例化时才使用类</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">some_method</span></span></div><div class="line">    <span class="comment"># 省略主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">some_other_method</span></span></div><div class="line">    <span class="comment"># 省略主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">SomeModule</span></span></div><div class="line">  module_function</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_method</span></span></div><div class="line">    <span class="comment"># 省略主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">some_other_method</span></span></div><div class="line">    <span class="comment"># 省略主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>总是替那些用以表示领域模型的类提供一个适当的 <code>to_s</code> 方法</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:first_name</span>, <span class="symbol">:last_name</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(first_name, last_name)</span></span></div><div class="line">    @first_name = first_name</div><div class="line">    @last_name = last_name</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">to_s</span></span></div><div class="line">    <span class="string">"<span class="subst">#&#123;@first_name&#125;</span> <span class="subst">#&#123;@last_name&#125;</span>"</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>使用 <code>attr</code> 系列方法来定义琐碎的存取器或修改器</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(first_name, last_name)</span></span></div><div class="line">    @first_name = first_name</div><div class="line">    @last_name = last_name</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">first_name</span></span></div><div class="line">    @first_name</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">last_name</span></span></div><div class="line">    @last_name</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:first_name</span>, <span class="symbol">:last_name</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(first_name, last_name)</span></span></div><div class="line">    @first_name = first_name</div><div class="line">    @last_name = last_name</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>优先考虑使用 Struct.new。它替你定义了那些琐碎的访问器、构造器及比较操作符</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="keyword">attr_accessor</span> <span class="symbol">:first_name</span>, <span class="symbol">:last_name</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(first_name, last_name)</span></span></div><div class="line">    @first_name = first_name</div><div class="line">    @last_name = last_name</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 更好</span></div><div class="line">Person = Struct.new(<span class="symbol">:first_name</span>, <span class="symbol">:last_name</span>) <span class="keyword">do</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>倾向使用鸭子类型而不是继承</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span></div><div class="line">  <span class="comment"># 抽象方法</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">speak</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 继承父类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Duck</span> &lt; Animal</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">speak</span></span></div><div class="line">    puts <span class="string">'Quack! Quack'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 继承父类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> &lt; Animal</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">speak</span></span></div><div class="line">    puts <span class="string">'Bau! Bau!'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Duck</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">speak</span></span></div><div class="line">    puts <span class="string">'Quack! Quack'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">speak</span></span></div><div class="line">    puts <span class="string">'Bau! Bau!'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>避免使用类变量（<code>@@</code>）。类变量在继承方面存在令人生厌的行为</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span></span></div><div class="line">  @@class_var = <span class="string">'parent'</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">print_class_var</span></span></div><div class="line">    puts @@class_var</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> &lt; Parent</span></div><div class="line">  @@class_var = <span class="string">'child'</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">Parent.print_class_var <span class="comment"># =&gt; 此处打印的结果为 'child'</span></div></pre></td></tr></table></figure>
<p>使用 <code>def self.method</code> 定义类方法。这种做法使得在代码重构时，即使修改了类名也无需做多次修改</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span></span></div><div class="line">  <span class="comment"># 差</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">TestClass</span>.<span class="title">some_method</span></span></div><div class="line">    <span class="comment"># 省略主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 好</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">some_other_method</span></span></div><div class="line">    <span class="comment"># 省略主体</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 在需要定义多个类方法时，另一种便捷写法</span></div><div class="line">  <span class="class"><span class="keyword">class</span> &lt;&lt; self</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">first_method</span></span></div><div class="line">      <span class="comment"># 省略主体</span></div><div class="line">    <span class="keyword">end</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">second_method_etc</span></span></div><div class="line">      <span class="comment"># 省略主体</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>在类的词法作用域中定义方法别名时，倾向使用 <code>alias</code>。因为定义期间 <code>alias</code> 与 <code>self</code> 指向的都是词法作用域，除非明确说明，否则该别名所引用的方法不会在运行期间被改变，或是在任何子类中被修改。因为 <code>alias</code> 与 <code>def</code> 一样都是关键字，倾向使用裸字而不是符号或字符串。也就是说，使用 <code>alias foo bar</code> 而不是 <code>alias :foo :bar</code></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Westerner</span></span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">first_name</span></span></div><div class="line">    @names.first</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="keyword">alias</span> given_name first_name</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>另外需要了解 Ruby 是如何处理别名和继承的：别名所引用的原始方法是在定义期间被指定的，而不是运行期间。</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fugitive</span> &lt; Westerner</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">first_name</span></span></div><div class="line">    <span class="string">'Nobody'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>在这个例子中，<code>Fugitive#given_name</code> 仍然调用原先的 <code>Westerner#first_name</code> 方法，而不是 <code>Fugitive#first_name</code>。如果想要覆写 <code>Fugitive#given_name</code>，必须在子类中重新定义</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fugitive</span> &lt; Westerner</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">first_name</span></span></div><div class="line">    <span class="string">'Nobody'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="keyword">alias</span> given_name first_name</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h2 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h2><p>对于异常处理，倾向使用 <code>raise</code> 而不是 <code>fail</code></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">fail SomeException, <span class="string">'message'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">raise SomeException, <span class="string">'message'</span></div></pre></td></tr></table></figure>
<p>不要在带双参数形式的 raise 方法中显式指定 RuntimeError</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">raise RuntimeError, <span class="string">'message'</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 默认就是 RuntimeError</span></div><div class="line">raise <span class="string">'message'</span></div></pre></td></tr></table></figure>
<p>倾向使用带异常类、消息的双参数形式调用 raise 方法，而不是使用异常的实例</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差 - 并无 raise SomeException.new('message') [, backtraces] 这种调用形式</span></div><div class="line">raise SomeException.new(<span class="string">'message'</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好 - 与调用形式 raise SomeException [, 'message' [, backtraces]] 保持一致</span></div><div class="line">raise SomeException, <span class="string">'message'</span></div></pre></td></tr></table></figure>
<p>永远不要从 <code>ensure</code> 区块返回。如果你显式地从 <code>ensure</code> 区块返回，那么其所在的方法会如同永远不会发生异常般的返回。事实上，异常被默默地丢弃了</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span></span></div><div class="line">  raise</div><div class="line"><span class="keyword">ensure</span></div><div class="line">  <span class="keyword">return</span> <span class="string">'very bad idea'</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>尽可能隐式地使用 <code>begin/rescue/ensure/end</code> 区块</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span></span></div><div class="line">  <span class="keyword">begin</span></div><div class="line">    <span class="comment"># 主逻辑</span></div><div class="line">  <span class="keyword">rescue</span></div><div class="line">    <span class="comment"># 异常处理逻辑</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span></span></div><div class="line">  <span class="comment"># 主逻辑</span></div><div class="line"><span class="keyword">rescue</span></div><div class="line">  <span class="comment"># 异常处理逻辑</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>通过使用 contingency 方法（一个由 Avdi Grimm 创造的词）来减少 <code>begin/rescue/ensure/end</code> 区块的使用</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  something_that_might_fail</div><div class="line"><span class="keyword">rescue</span> IOError</div><div class="line">  <span class="comment"># 处理 IOError</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">  something_else_that_might_fail</div><div class="line"><span class="keyword">rescue</span> IOError</div><div class="line">  <span class="comment"># 处理 IOError</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">with_io_error_handling</span></span></div><div class="line">   <span class="keyword">yield</span></div><div class="line"><span class="keyword">rescue</span> IOError</div><div class="line">  <span class="comment"># 处理 IOError</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">with_io_error_handling &#123; something_that_might_fail &#125;</div><div class="line"></div><div class="line">with_io_error_handling &#123; something_else_that_might_fail &#125;</div></pre></td></tr></table></figure>
<p>避免捕获 Exception。这种做法会同时将信号与 <code>exit</code> 方法困住，导致你必须使用 <code>kill -9</code> 来终止进程</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差 - 信号与 exit 方法产生的异常会被捕获（除了 kill -9）</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  exit</div><div class="line"><span class="keyword">rescue</span> Exception</div><div class="line">  puts <span class="string">"you didn't really want to exit, right?"</span></div><div class="line">  <span class="comment"># 处理异常</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 没有指定具体异常的 rescue 子句默认捕获 StandardError</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  <span class="comment"># 抛出异常</span></div><div class="line"><span class="keyword">rescue</span> =&gt; e</div><div class="line">  <span class="comment"># 处理异常</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 指定具体异常 StandardError</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  <span class="comment"># 抛出异常</span></div><div class="line"><span class="keyword">rescue</span> StandardError =&gt; e</div><div class="line">  <span class="comment"># 处理异常</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>把较具体的异常放在处理链的较上层，不然它们永远不会被执行</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  <span class="comment"># 抛出异常</span></div><div class="line"><span class="keyword">rescue</span> StandardError =&gt; e</div><div class="line">  <span class="comment"># 处理异常</span></div><div class="line"><span class="keyword">rescue</span> IOError =&gt; e</div><div class="line">  <span class="comment"># 处理异常，但事实上永远不会被执行</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  <span class="comment"># 抛出异常</span></div><div class="line"><span class="keyword">rescue</span> IOError =&gt; e</div><div class="line">  <span class="comment"># 处理异常</span></div><div class="line"><span class="keyword">rescue</span> StandardError =&gt; e</div><div class="line">  <span class="comment"># 处理异常</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>在 <code>ensure</code> 区块释放程序的外部资源</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line">f = File.open(<span class="string">'testfile'</span>)</div><div class="line"><span class="keyword">begin</span></div><div class="line">  <span class="comment"># .. 文件操作</span></div><div class="line"><span class="keyword">rescue</span></div><div class="line">  <span class="comment"># .. 处理异常</span></div><div class="line"><span class="keyword">ensure</span></div><div class="line">  f.close <span class="keyword">if</span> f</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>在调用资源获取方法时，尽量使用具备自动清理功能的版本</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差 - 需要显式关闭文件描述符</span></div><div class="line">f = File.open(<span class="string">'testfile'</span>)</div><div class="line">  <span class="comment"># ...</span></div><div class="line">f.close</div><div class="line"></div><div class="line"><span class="comment"># 好 - 文件描述符会被自动关闭</span></div><div class="line">File.open(<span class="string">'testfile'</span>) <span class="keyword">do</span> <span class="params">|f|</span></div><div class="line">  <span class="comment"># ...</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h2 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h2><ul>
<li>当访问数组的首元素或尾元素时，倾向使用 <code>first</code> 或 <code>last</code> 而不是 <code>[0]</code> 或 <code>[-1]</code></li>
<li>当处理的对象不存在重复元素时，使用 <code>Set</code> 来替代 <code>Array</code>。<code>Set</code> 是实现了无序且无重复元素的集合类型。它兼具 <code>Array</code> 的直观操作与 <code>Hash</code> 的快速查找</li>
<li>利用“Ruby 1.9 之后的哈希是有序的”的这个特性</li>
<li>当遍历集合时，不要改动它</li>
<li></li>
</ul>
<p>对于数组与哈希，倾向使用字面量语法来构建实例（除非你需要给构造器传递参数）</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">arr = Array.new</div><div class="line">hash = Hash.new</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">arr = []</div><div class="line">hash = &#123;&#125;</div></pre></td></tr></table></figure>
<p>当创建一组元素为单词（没有空格或特殊字符）的数组时，倾向使用 <code>%w</code> 而不是 <code>[]</code>。此规则只适用于数组元素有两个或以上的时候</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">STATES = [<span class="string">'draft'</span>, <span class="string">'open'</span>, <span class="string">'closed'</span>]</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">STATES = <span class="string">%w(draft open closed)</span></div></pre></td></tr></table></figure>
<p>当创建一组符号类型的数组（且不需要保持 Ruby 1.9 兼容性）时，倾向使用 %i。此规则只适用于数组元素有两个或以上的时候</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">STATES = [<span class="symbol">:draft</span>, <span class="symbol">:open</span>, <span class="symbol">:closed</span>]</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">STATES = %i(draft open closed)</div></pre></td></tr></table></figure>
<p>避免在数组中创造巨大的间隔</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line">arr = []</div><div class="line">arr[<span class="number">100</span>] = <span class="number">1</span> <span class="comment"># 现在你有一个很多 nil 的数组</span></div></pre></td></tr></table></figure>
<p>当哈希键为符号时，使用 Ruby 1.9 的字面量语法</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">hash = &#123; <span class="symbol">:one</span> =&gt; <span class="number">1</span>, <span class="symbol">:two</span> =&gt; <span class="number">2</span>, <span class="symbol">:three</span> =&gt; <span class="number">3</span> &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">hash = &#123; <span class="symbol">one:</span> <span class="number">1</span>, <span class="symbol">two:</span> <span class="number">2</span>, <span class="symbol">three:</span> <span class="number">3</span> &#125;</div></pre></td></tr></table></figure>
<p>当哈希键既有符号又有字符串时，不要使用 Ruby 1.9 的字面量语法</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">&#123; <span class="symbol">a:</span> <span class="number">1</span>, <span class="string">'b'</span> =&gt; <span class="number">2</span> &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">&#123; <span class="symbol">:a</span> =&gt; <span class="number">1</span>, <span class="string">'b'</span> =&gt; <span class="number">2</span> &#125;</div></pre></td></tr></table></figure>
<p>倾向使用 <code>Hash#key?</code> 而不是 <code>Hash#has_key?</code>，使用 <code>Hash#value?</code> 而不是 <code>Hash#has_value?</code></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">hash.has_key?(<span class="symbol">:test</span>)</div><div class="line">hash.has_value?(value)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">hash.key?(<span class="symbol">:test</span>)</div><div class="line">hash.value?(value)</div></pre></td></tr></table></figure>
<p>倾向使用 <code>Hash#each_key</code> 而不是 <code>Hash#keys.each</code>，使用 <code>Hash#each_value</code> 而不是 <code>Hash#values.each</code></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">hash.keys.each &#123; <span class="params">|k|</span> p k &#125;</div><div class="line">hash.values.each &#123; <span class="params">|v|</span> p v &#125;</div><div class="line">hash.each &#123; <span class="params">|k, _v|</span> p k &#125;</div><div class="line">hash.each &#123; <span class="params">|_k, v|</span> p v &#125;</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">hash.each_key &#123; <span class="params">|k|</span> p k &#125;</div><div class="line">hash.each_value &#123; <span class="params">|v|</span> p v &#125;</div></pre></td></tr></table></figure>
<p>当处理应该存在的哈希键时，使用 <code>Hash#fetch</code></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line">heroes = &#123; <span class="symbol">batman:</span> <span class="string">'Bruce Wayne'</span>, <span class="symbol">superman:</span> <span class="string">'Clark Kent'</span> &#125;</div><div class="line"></div><div class="line"><span class="comment"># 差 - 如果我们打错了哈希键，则难以发现这个错误</span></div><div class="line">heroes[<span class="symbol">:batman</span>] <span class="comment"># =&gt; 'Bruce Wayne'</span></div><div class="line">heroes[<span class="symbol">:supermann</span>] <span class="comment"># =&gt; nil</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - fetch 会抛出 KeyError 使这个错误显而易见</span></div><div class="line">heroes.fetch(<span class="symbol">:supermann</span>)</div></pre></td></tr></table></figure>
<p>当为哈希键的值提供默认值时，倾向使用 <code>Hash#fetch</code> 而不是自定义逻辑</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line">batman = &#123; <span class="symbol">name:</span> <span class="string">'Bruce Wayne'</span>, <span class="symbol">is_evil:</span> <span class="literal">false</span> &#125;</div><div class="line"></div><div class="line"><span class="comment"># 差 - 如果仅仅使用 || 操作符，那么当值为假时，我们不会得到预期结果</span></div><div class="line">batman[<span class="symbol">:is_evil</span>] <span class="params">||</span> <span class="literal">true</span> <span class="comment"># =&gt; true</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - fetch 在遇到假值时依然可以正确工作</span></div><div class="line">batman.fetch(<span class="symbol">:is_evil</span>, <span class="literal">true</span>) <span class="comment"># =&gt; false</span></div></pre></td></tr></table></figure>
<p>当提供默认值的求值代码具有副作用或开销较大时，倾向使用 <code>Hash#fetch</code> 的区块形式</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line">batman = &#123; <span class="symbol">name:</span> <span class="string">'Bruce Wayne'</span> &#125;</div><div class="line"></div><div class="line"><span class="comment"># 差 - 此形式会立即求值，如果调用多次，可能会影响程序的性能</span></div><div class="line">batman.fetch(<span class="symbol">:powers</span>, obtain_batman_powers) <span class="comment"># obtain_batman_powers 开销较大</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 此形式会惰性求值，只有抛出 KeyError 时，才会产生开销</span></div><div class="line">batman.fetch(<span class="symbol">:powers</span>) &#123; obtain_batman_powers &#125;</div></pre></td></tr></table></figure>
<p>当需要一次性从哈希中获取多个键的值时，使用 <code>Hash#values_at</code></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">email = data[<span class="string">'email'</span>]</div><div class="line">username = data[<span class="string">'nickname'</span>]</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">email, username = data.values_at(<span class="string">'email'</span>, <span class="string">'nickname'</span>)</div></pre></td></tr></table></figure>
<p>当为集合提供存取器时，尽量支持索引值为 <code>nil</code> 的访问形式</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">awesome_things</span></span></div><div class="line">  @awesome_things</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">awesome_things</span><span class="params">(index = <span class="literal">nil</span>)</span></span></div><div class="line">  <span class="keyword">if</span> index &amp;&amp; @awesome_things</div><div class="line">    @awesome_things[index]</div><div class="line">  <span class="keyword">else</span></div><div class="line">    @awesome_things</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<h2 id="数值"><a href="#数值" class="headerlink" title="数值"></a>数值</h2><p>通过 <code>Integer</code> 检查对象是否是数值类型，而不是 <code>Fixnum</code> 或 <code>Bignum</code>。因为 <code>Fixnum</code> 或 <code>Bignum</code> 表达的数值大小存在范围限定</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line">timestamp = Time.now.to_i</div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">timestamp.is_a? Fixnum</div><div class="line">timestamp.is_a? Bignum</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">timestamp.is_a? Integer</div></pre></td></tr></table></figure>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p>倾向使用字符串插值或字符串格式化，而不是字符串拼接</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">email_with_name = user.name + <span class="string">' &lt;'</span> + user.email + <span class="string">'&gt;'</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">email_with_name = <span class="string">"<span class="subst">#&#123;user.name&#125;</span> &lt;<span class="subst">#&#123;user.email&#125;</span>&gt;"</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">email_with_name = format(<span class="string">'%s &lt;%s&gt;'</span>, user.name, user.email)</div></pre></td></tr></table></figure>
<p>不要忘记使用 {} 包裹字符串插值中的实例变量或全局变量</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></div><div class="line">  <span class="keyword">attr_reader</span> <span class="symbol">:first_name</span>, <span class="symbol">:last_name</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(first_name, last_name)</span></span></div><div class="line">    @first_name = first_name</div><div class="line">    @last_name = last_name</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 差 - 语法正确，但略显笨拙</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">to_s</span></span></div><div class="line">    <span class="string">"#@first_name #@last_name"</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># 好</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">to_s</span></span></div><div class="line">    <span class="string">"<span class="subst">#&#123;@first_name&#125;</span> <span class="subst">#&#123;@last_name&#125;</span>"</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">$global = <span class="number">0</span></div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">puts <span class="string">"$global = #$global"</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">puts <span class="string">"$global = <span class="subst">#&#123;$global&#125;</span>"</span></div></pre></td></tr></table></figure>
<p>在字符串插值中，不要显式调用 <code>Object#to_s</code> 方法，Ruby 会自动调用它</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">message = <span class="string">"This is the <span class="subst">#&#123;result.to_s&#125;</span>."</span></div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">message = <span class="string">"This is the <span class="subst">#&#123;result&#125;</span>."</span></div></pre></td></tr></table></figure>
<p>当你需要构造巨大的数据块时，避免使用 <code>String#+</code>，使用 <code>String#&lt;&lt;</code> 来替代。<code>String#&lt;&lt;</code> 通过修改原始对象进行拼接工作，其比 <code>String#+</code> 效率更高，因为后者需要产生一堆新的字符串对象</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 差</span></div><div class="line">html = <span class="string">''</span></div><div class="line">html += <span class="string">'&lt;h1&gt;Page title&lt;/h1&gt;'</span></div><div class="line"></div><div class="line">paragraphs.each <span class="keyword">do</span> <span class="params">|paragraph|</span></div><div class="line">  html += <span class="string">"&lt;p&gt;<span class="subst">#&#123;paragraph&#125;</span>&lt;/p&gt;"</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 好 - 并且效率更高</span></div><div class="line">html = <span class="string">''</span></div><div class="line">html &lt;&lt; <span class="string">'&lt;h1&gt;Page title&lt;/h1&gt;'</span></div><div class="line"></div><div class="line">paragraphs.each <span class="keyword">do</span> <span class="params">|paragraph|</span></div><div class="line">  html &lt;&lt; <span class="string">"&lt;p&gt;<span class="subst">#&#123;paragraph&#125;</span>&lt;/p&gt;"</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>当存在更快速、更专业的替代方案时，不要使用 <code>String#gsub</code></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line">url = <span class="string">'http://example.com'</span></div><div class="line">str = <span class="string">'lisp-case-rules'</span></div><div class="line"></div><div class="line"><span class="comment"># 差</span></div><div class="line">url.gsub(<span class="string">'http://'</span>, <span class="string">'https://'</span>)</div><div class="line">str.gsub(<span class="string">'-'</span>, <span class="string">'_'</span>)</div><div class="line"></div><div class="line"><span class="comment"># 好</span></div><div class="line">url.sub(<span class="string">'http://'</span>, <span class="string">'https://'</span>)</div><div class="line">str.tr(<span class="string">'-'</span>, <span class="string">'_'</span>)</div></pre></td></tr></table></figure>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li>总是开启 <code>ruby -w</code> 选项，以编写安全的代码</li>
<li>避免使用哈希作为可选参数。这个方法是不是做太多事了？（对象构造器除外）</li>
<li>避免单个方法的长度超过 10 行（不计入空行）。理想上，大部分方法应当不超过 5 行</li>
<li>避免参数列表数目多于三或四个</li>
<li>如果你真的需要“全局”方法，将它们添加到 <code>Kernel</code> 并设为私有</li>
<li>使用 <code>OptionParser</code> 来解析复杂的命令行选项。使用 <code>ruby -s</code> 来处理琐碎的命令行选项</li>
<li>使用 <code>Time.now</code> 而不是 <code>Time.new</code> 来获取当前的系统时间</li>
<li>使用函数式思维编写程序，避免副作用</li>
<li>不要修改参数值，除非那就是这个方法的作用</li>
</ul>
<h2 id="相关工具"><a href="#相关工具" class="headerlink" title="相关工具"></a>相关工具</h2><ul>
<li><a href="https://github.com/bbatsov/rubocop" target="_blank" rel="external">RuboCop</a> - 代码风格检查工具</li>
<li><a href="http://rdoc.sourceforge.net/doc/" target="_blank" rel="external">RDoc</a> - 编写 API 文档</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://github.com/JuanitoFatas/ruby-style-guide/blob/master/README-zhCN.md" target="_blank" rel="external">Ruby 风格指南</a></li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>捧个钱场？</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/misc/wechat.jpg" alt="wdxtub WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/misc/alipay.jpg" alt="wdxtub Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/语法/" rel="tag"># 语法</a>
          
            <a href="/tags/Ruby/" rel="tag"># Ruby</a>
          
            <a href="/tags/风格/" rel="tag"># 风格</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/06/14/to-life/" rel="next" title="致生活">
                <i class="fa fa-chevron-left"></i> 致生活
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/06/16/my-rails-style/" rel="prev" title="Rails 编码风格指南">
                Rails 编码风格指南 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/misc/avatar.jpg"
               alt="wdxtub" />
          <p class="site-author-name" itemprop="name">wdxtub</p>
          <p class="site-description motion-element" itemprop="description">Engineer Blogger Creator Runner | ML DM NLP Web | 航拍 旅行 电影 音乐 | 有朋自远方来不亦乐乎 | @CMU @SYSU</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">828</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">934</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/wdxtub" target="_blank" title="GitHub">
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/wdxtub" target="_blank" title="微博">
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://douban.com/people/wdx" target="_blank" title="豆瓣">
                  
                  豆瓣
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/wdxtub" target="_blank" title="知乎">
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-nd.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              不妨看看
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://zhchbin.github.io/" title="zhchbin" target="_blank">zhchbin</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.algorithmdog.com/" title="算法狗" target="_blank">算法狗</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.52cs.org/" title="我爱计算机" target="_blank">我爱计算机</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://wdxtub.lofter.com/" title="我的 Lofter" target="_blank">我的 Lofter</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://wdxtub.com/interview/" title="刷题笔记" target="_blank">刷题笔记</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#源代码排版"><span class="nav-number">1.</span> <span class="nav-text">源代码排版</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#语法"><span class="nav-number">2.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#命名"><span class="nav-number">3.</span> <span class="nav-text">命名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#类与模块"><span class="nav-number">4.</span> <span class="nav-text">类与模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#异常"><span class="nav-number">5.</span> <span class="nav-text">异常</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#集合"><span class="nav-number">6.</span> <span class="nav-text">集合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数值"><span class="nav-number">7.</span> <span class="nav-text">数值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#字符串"><span class="nav-number">8.</span> <span class="nav-text">字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他"><span class="nav-number">9.</span> <span class="nav-text">其他</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#相关工具"><span class="nav-number">10.</span> <span class="nav-text">相关工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">11.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wdxtub</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


</body>
</html>
